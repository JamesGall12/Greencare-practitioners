<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Greencare Practitioner Breakdown - Live Data</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #064e3b 0%, #047857 50%, #059669 100%);
min-height: 100vh;
padding: 20px;
}
.container {
max-width: 1600px;
margin: 0 auto;
}
.header {
background: white;
border-radius: 20px;
padding: 40px;
margin-bottom: 25px;
text-align: center;
box-shadow: 0 10px 40px rgba(0,0,0,0.15);
}
.title {
font-size: 3rem;
color: #064e3b;
margin-bottom: 10px;
font-weight: 700;
}
.subtitle {
color: #6b7280;
font-size: 1.3rem;
margin-bottom: 25px;
}
.performance-summary {
display: inline-flex;
align-items: center;
gap: 20px;
background: #ecfdf5;
border: 2px solid #059669;
border-radius: 15px;
padding: 20px 30px;
color: #064e3b;
font-weight: 600;
font-size: 1.2rem;
}
.nav {
background: white;
border-radius: 20px;
padding: 25px;
margin-bottom: 25px;
text-align: center;
box-shadow: 0 6px 25px rgba(0,0,0,0.1);
}
.tab-button {
background: #f3f4f6;
border: none;
padding: 15px 35px;
margin: 0 8px;
border-radius: 12px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
font-size: 1.1rem;
}
.tab-button:hover {
background: #e5e7eb;
transform: translateY(-3px);
}
.tab-button.active {
background: #059669;
color: white;
box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
}
.card {
background: white;
border-radius: 20px;
padding: 30px;
margin-bottom: 25px;
box-shadow: 0 6px 25px rgba(0,0,0,0.08);
}
.table {
width: 100%;
border-collapse: collapse;
margin-top: 20px;
}
.table th,
.table td {
text-align: left;
padding: 15px;
border-bottom: 1px solid #e5e7eb;
}
.table th {
background: #f8fafc;
font-weight: 600;
color: #374151;
text-transform: uppercase;
font-size: 0.85rem;
letter-spacing: 0.5px;
}
.table tr:hover {
background: #f9fafb;
}
.performer-excellent { background: #ecfdf5; }
.performer-good { background: #fef3c7; }
.performer-average { background: #fef2f2; }
.tab-content {
display: none;
}
.tab-content.active {
display: block;
}
.insight-card {
background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
border-radius: 15px;
padding: 25px;
border-left: 5px solid #059669;
margin: 20px 0;
}
.insight-title {
font-weight: 600;
color: #064e3b;
margin-bottom: 15px;
font-size: 1.2rem;
}
.insight-text {
color: #047857;
line-height: 1.6;
font-size: 1rem;
}
.loading {
text-align: center;
padding: 40px;
color: #6b7280;
}
.error {
background: #fef2f2;
border: 1px solid #fca5a5;
border-radius: 8px;
padding: 15px;
color: #dc2626;
margin: 20px 0;
}
.refresh-btn {
background: #059669;
color: white;
border: none;
padding: 10px 20px;
border-radius: 8px;
cursor: pointer;
margin: 10px;
}
.refresh-btn:hover {
background: #047857;
}
@media (max-width: 768px) {
.title {
font-size: 2.5rem;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1 class="title">Greencare Practitioner Breakdown</h1>
<p class="subtitle">Live Performance Analysis | <span id="lastUpdated">Loading...</span></p>
<div class="performance-summary" id="summaryStats">
üìä Loading data...
</div>
<button class="refresh-btn" onclick="loadAllData()">üîÑ Refresh Data</button>
</div>

<div class="card">
<h3 style="margin-bottom: 25px; color: #064e3b;">Practitioner Discharge Analysis</h3>
<div style="overflow-x: auto;">
<div id="dashboardTableContainer">
<div class="loading">Loading dashboard data...</div>
</div>
</div>
<div class="insight-card">
<div class="insight-title">üö® Key Performance Insights</div>
<div class="insight-text" id="keyInsights">
Loading insights...
</div>
</div>
</div>

</div>

<script>
// Configuration - Your actual values
const CONFIG = {
    spreadsheetId: '1265tU_Frn4Skphu6sUlV-l4OicwhU9j8oqtNQKOQnB8', 
    apiKey: 'AIzaSyDiJm2zhhdrCN6_Q0aNRvcRpefAzOMYgT4',
    dataSheet: 'Sheet 1' // Updated to match your actual sheet name with space
};

// Global data storage
let dashboardData = [];

// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
});

async function loadAllData() {
    loadDashboardData();
}

async function loadDashboardData() {
    try {
        // Skip first row (title) and get data starting from row 2
        const range = `${CONFIG.dataSheet}!A2:H`; 
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.spreadsheetId}/values/${range}?key=${CONFIG.apiKey}`;
        
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (!data.values || data.values.length < 1) {
            throw new Error('No data found in spreadsheet');
        }
        
        // Process data - mapping to your specific columns:
        // Column A (0): Practitioner, Column D (3): Patient Requested %, 
        // Column F (5): Practitioner Requested %, Column H (7): Total %
        dashboardData = data.values
            .filter(row => row[0] && row[0].trim() !== '' && row[0] !== 'Total') // Filter out empty rows and total row
            .map(row => ({
                name: row[0] ? row[0].trim() : '',           // Column A: Practitioner
                patientRequested: row[3] || 'N/A',          // Column D: Patient Requested %
                practitionerRequested: row[5] || 'N/A',     // Column F: Practitioner Requested % 
                total: row[7] || 'N/A'                      // Column H: Total %
            }));
        
        renderDashboardTable();
        updateInsights();
        updateSummaryStats();
        updateLastUpdated();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        document.getElementById('dashboardTableContainer').innerHTML = 
            `<div class="error">Error loading data: ${error.message}</div>`;
    }
}

function renderDashboardTable() {
    const container = document.getElementById('dashboardTableContainer');
    
    let tableHTML = `
        <table class="table" id="dashboardTable">
            <thead>
                <tr>
                    <th onclick="sortTable(0)" style="cursor: pointer;">Practitioner ‚Üï</th>
                    <th onclick="sortTable(1)" style="cursor: pointer;">Patient Requested % ‚Üï</th>
                    <th onclick="sortTable(2)" style="cursor: pointer;">Practitioner Requested % ‚Üï</th>
                    <th onclick="sortTable(3)" style="cursor: pointer;">Total % ‚Üï</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    dashboardData.forEach(practitioner => {
        const performanceClass = getTotalDischargeClass(practitioner.total);
        
        tableHTML += `
            <tr class="${performanceClass}">
                <td><strong>${practitioner.name}</strong></td>
                <td style="color: ${getDischargeColor(practitioner.patientRequested)}; font-weight: bold;">
                    ${practitioner.patientRequested}
                </td>
                <td style="color: ${getDischargeColor(practitioner.practitionerRequested)}; font-weight: bold;">
                    ${practitioner.practitionerRequested}
                </td>
                <td style="color: ${getDischargeColor(practitioner.total)}; font-weight: bold;">
                    ${practitioner.total}
                </td>
            </tr>
        `;
    });
    
    tableHTML += `
            </tbody>
        </table>
    `;
    
    container.innerHTML = tableHTML;
}

function updateInsights() {
    if (dashboardData.length === 0) return;
    
    // Find practitioners with highest and lowest discharge rates
    const validData = dashboardData.filter(p => p.total !== 'N/A' && !p.total.includes('N/A'));
    
    if (validData.length === 0) {
        document.getElementById('keyInsights').innerHTML = 'No valid discharge data available for analysis.';
        return;
    }
    
    // Convert percentages to numbers for analysis
    const practitionersWithNumbers = validData.map(p => ({
        ...p,
        totalNum: parseFloat(p.total.replace('%', '')),
        patientNum: parseFloat(p.patientRequested.replace('%', '')) || 0
    }));
    
    // Sort by total discharge rate
    practitionersWithNumbers.sort((a, b) => b.totalNum - a.totalNum);
    
    const highest = practitionersWithNumbers[0];
    const lowest = practitionersWithNumbers[practitionersWithNumbers.length - 1];
    
    // Find practitioners with high patient-initiated discharge rates
    const highPatientRequested = practitionersWithNumbers
        .filter(p => p.patientNum > 5)
        .sort((a, b) => b.patientNum - a.patientNum);
    
    let insights = `
        <strong>üî¥ Highest Risk:</strong><br>
        ‚Ä¢ <strong>${highest.name}:</strong> ${highest.total} total discharge rate<br><br>
        
        <strong>üü¢ Best Performance:</strong><br>
        ‚Ä¢ <strong>${lowest.name}:</strong> ${lowest.total} total discharge rate<br><br>
    `;
    
    if (highPatientRequested.length > 0) {
        insights += `
            <strong>‚ö†Ô∏è High Patient-Initiated Discharges:</strong><br>
        `;
        highPatientRequested.slice(0, 3).forEach(p => {
            insights += `‚Ä¢ <strong>${p.name}:</strong> ${p.patientRequested} patient-requested<br>`;
        });
        insights += `<br><strong>Action Required:</strong> Review patient satisfaction and communication protocols for high-risk practitioners.`;
    }
    
    document.getElementById('keyInsights').innerHTML = insights;
}

// Utility functions
function getTotalDischargeClass(total) {
    if (total === 'N/A') return 'performer-average';
    const rate = parseFloat(total.replace('%', ''));
    if (rate <= 4) return 'performer-excellent';
    if (rate <= 10) return 'performer-good';
    return 'performer-average';
}

function getDischargeColor(value) {
    if (value === 'N/A' || value === null || value === undefined) return '#6b7280';
    const rate = parseFloat(value.toString().replace('%', ''));
    if (rate <= 2) return '#059669';
    if (rate <= 7) return '#f59e0b';
    return '#dc2626';
}

function updateSummaryStats() {
    if (dashboardData.length === 0) return;
    
    const totalPractitioners = dashboardData.length;
    const validData = dashboardData.filter(p => p.total !== 'N/A' && !p.total.includes('N/A'));
    
    if (validData.length > 0) {
        const avgTotal = validData.reduce((sum, p) => sum + parseFloat(p.total.replace('%', '')), 0) / validData.length;
        
        document.getElementById('summaryStats').innerHTML = `
            üìä ${totalPractitioners} Total Practitioners | ${avgTotal.toFixed(1)}% Avg Total Discharge Rate | ${validData.length} Active Practitioners
        `;
    } else {
        document.getElementById('summaryStats').innerHTML = `
            üìä ${totalPractitioners} Total Practitioners | Data Loading...
        `;
    }
}

function updateLastUpdated() {
    const now = new Date();
    const timeString = now.toLocaleString();
    document.getElementById('lastUpdated').textContent = timeString;
}

function showError(message) {
    document.getElementById('dashboardTableContainer').innerHTML = `<div class="error">${message}</div>`;
}

// Simplified sorting function
function sortTable(columnIndex) {
    const table = document.getElementById('dashboardTable');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    // Determine sort direction
    const isAscending = table.getAttribute('data-sort-direction') !== 'asc';
    table.setAttribute('data-sort-direction', isAscending ? 'asc' : 'desc');
    
    // Sort rows
    rows.sort((a, b) => {
        const cellA = a.cells[columnIndex].textContent.trim();
        const cellB = b.cells[columnIndex].textContent.trim();
        
        let valueA, valueB;
        
        if (columnIndex === 0) {
            // Name column - text sorting
            valueA = cellA.toLowerCase();
            valueB = cellB.toLowerCase();
        } else {
            // Percentage columns - handle N/A and extract numbers
            if (cellA === 'N/A') valueA = -1;
            else valueA = parseFloat(cellA.replace('%', ''));
            
            if (cellB === 'N/A') valueB = -1;
            else valueB = parseFloat(cellB.replace('%', ''));
        }
        
        if (typeof valueA === 'number' && typeof valueB === 'number') {
            return isAscending ? valueA - valueB : valueB - valueA;
        } else {
            if (valueA < valueB) return isAscending ? -1 : 1;
            if (valueA > valueB) return isAscending ? 1 : -1;
            return 0;
        }
    });
    
    // Clear and repopulate tbody
    tbody.innerHTML = '';
    rows.forEach(row => tbody.appendChild(row));
    
    // Update header indicators
    const headers = table.querySelectorAll('th');
    headers.forEach((header, index) => {
        if (index === columnIndex) {
            const text = header.textContent.replace(' ‚Üï', '').replace(' ‚Üë', '').replace(' ‚Üì', '');
            header.textContent = text + (isAscending ? ' ‚Üë' : ' ‚Üì');
        } else {
            const text = header.textContent.replace(' ‚Üï', '').replace(' ‚Üë', '').replace(' ‚Üì', '');
            header.textContent = text + ' ‚Üï';
        }
    });
}
</script>
</body>
</html>
